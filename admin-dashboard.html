<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ADMIN DASHBOARD v3.0 - 2024-12-21 - CACHE BUSTER -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Admin Dashboard - MocapWork</title>
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0F0F0F;
            --bg-card: rgba(26, 26, 26, 0.6);
            --teal: #F59E0B;
            --teal-light: #FBBF24;
            --amber: #FF6B6B;
            --amber-light: #FF8E8E;
            --green: #10B981;
            --red: #EF4444;
            --text-primary: #FEFCE8;
            --text-secondary: #E7E5D3;
            --text-muted: #A8A593;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Custom Scrollbar - Grey with Orange Accent */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #F59E0B 0%, #FF6B6B 100%);
            border-radius: 6px;
            border: 2px solid #1a1a1a;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #FBBF24 0%, #FF8E8E 100%);
        }

        /* Firefox Scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: #F59E0B #1a1a1a;
        }

        /* Header */
        .admin-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid rgba(100, 116, 139, 0.1);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .admin-logo {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--teal), var(--amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-user {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-email {
            color: var(--text-muted);
            font-size: 14px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--red);
            border-radius: 8px;
            color: var(--red);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--red);
            color: white;
        }

        .back-to-site-btn {
            padding: 8px 16px;
            background: rgba(100, 116, 139, 0.1);
            border: 1px solid var(--teal);
            border-radius: 8px;
            color: var(--teal);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .back-to-site-btn:hover {
            background: var(--teal);
            color: var(--bg-primary);
        }

        /* Main Layout */
        .admin-container {
            display: flex;
            min-height: calc(100vh - 81px);
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid rgba(100, 116, 139, 0.1);
            padding: 24px;
        }

        .nav-section {
            margin-bottom: 32px;
        }

        .nav-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .nav-item {
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .nav-item:hover {
            background: rgba(100, 116, 139, 0.1);
            color: var(--teal);
        }

        .nav-item.active {
            background: rgba(100, 116, 139, 0.15);
            color: var(--teal);
            font-weight: 600;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--teal), var(--amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-muted);
            font-size: 16px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--teal);
            transform: translateY(-4px);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--teal), var(--amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-change {
            font-size: 12px;
            margin-top: 8px;
        }

        .stat-change.positive {
            color: var(--green);
        }

        /* Content Card */
        .content-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.1);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-grid.full {
            grid-template-columns: 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 12px 16px;
            background: rgba(20, 20, 20, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--teal);
            box-shadow: 0 0 0 3px rgba(100, 116, 139, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        /* Toggle Switch */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(156, 163, 175, 0.3);
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--teal), var(--amber));
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed rgba(100, 116, 139, 0.3);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: var(--teal);
            background: rgba(100, 116, 139, 0.05);
        }

        .file-upload.dragover {
            border-color: var(--amber);
            background: rgba(245, 158, 11, 0.05);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 12px;
            color: var(--text-muted);
        }

        .file-preview {
            margin-top: 16px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .preview-item {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid rgba(100, 116, 139, 0.2);
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--teal), var(--amber));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(100, 116, 139, 0.4);
        }

        .btn-secondary {
            background: rgba(100, 116, 139, 0.1);
            border: 1px solid var(--teal);
            color: var(--teal);
        }

        .btn-secondary:hover {
            background: rgba(100, 116, 139, 0.2);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--red);
            color: var(--red);
        }

        .btn-danger:hover {
            background: var(--red);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid rgba(100, 116, 139, 0.2);
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 16px 12px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.1);
        }

        .data-table tr:hover {
            background: rgba(100, 116, 139, 0.05);
        }

        .table-thumbnail {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .action-btn.edit {
            background: rgba(100, 116, 139, 0.1);
            color: var(--teal);
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--red);
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        /* Badge */
        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-popular {
            background: rgba(245, 158, 11, 0.2);
            color: var(--amber);
        }

        .badge-sale {
            background: rgba(16, 185, 129, 0.2);
            color: var(--green);
        }

        .badge-holiday {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .spinner {
            border: 3px solid rgba(100, 116, 139, 0.1);
            border-top: 3px solid var(--teal);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        }

        .notification.success {
            background: rgba(16, 185, 129, 0.9);
            border: 2px solid var(--green);
            color: white;
        }

        .notification.error {
            background: rgba(239, 68, 68, 0.9);
            border: 2px solid var(--red);
            color: white;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Search & Filter */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            gap: 16px;
        }

        .search-box {
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: rgba(20, 20, 20, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 12px center;
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.1);
            border-radius: 16px;
            padding: 48px;
            width: 100%;
            max-width: 400px;
        }

        .login-logo {
            text-align: center;
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--teal), var(--amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 32px;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-logo">MocapWork Admin</div>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 24px;">
                You must be logged in as an admin to access this page
            </p>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 24px;">
                    Sign In to Admin
                </button>
                <div style="text-align: center; margin-top: 20px;">
                    <a href="index.html" style="color: var(--teal); text-decoration: none; font-size: 14px;">‚Üê Back to Main Site</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">MocapWork Admin</div>
            <div class="admin-user">
                <span class="user-email" id="userEmail"></span>
                <a href="index.html" class="back-to-site-btn">‚Üê Back to Site</a>
                <button class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </header>

        <div class="admin-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="nav-section">
                    <div class="nav-title">Main</div>
                    <div class="nav-item active" onclick="showPage('overview')">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                        <span>Overview</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title">Animations</div>
                    <div class="nav-item" onclick="showPage('add-animation')">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span>Add New</span>
                    </div>
                    <div class="nav-item" onclick="showPage('all-animations')">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                        </svg>
                        <span>All Animations</span>
                    </div>
                    <div class="nav-item" onclick="showPage('bulk-edit')">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                        <span>Bulk Edit</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title">Content</div>
                    <div class="nav-item" onclick="showPage('carousel')">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span>Hero Carousel</span>
                    </div>
                    <div class="nav-item" onclick="showPage('tags')">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                        </svg>
                        <span>Manage Tags</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title">Settings</div>
                    <div class="nav-item" onclick="showPage('users')">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <span>User Management</span>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Overview Page -->
                <div id="overviewPage" class="page">
                    <div class="page-header">
                        <h1 class="page-title">Dashboard Overview</h1>
                        <p class="page-subtitle">Manage your motion capture library</p>
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Animations</div>
                            <div class="stat-value" id="totalAnimations">0</div>
                            <div class="stat-change positive">‚Üë View all</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Popular Items</div>
                            <div class="stat-value" id="popularCount">0</div>
                            <div class="stat-change">Marked as popular</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">On Sale</div>
                            <div class="stat-value" id="onSaleCount">0</div>
                            <div class="stat-change">Active sales</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Categories</div>
                            <div class="stat-value" id="categoriesCount">0</div>
                            <div class="stat-change">Different types</div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="content-card">
                        <h2 class="card-title">Recent Additions</h2>
                        <div id="recentAnimations" class="loading">
                            <div class="spinner"></div>
                            Loading...
                        </div>
                    </div>
                </div>

                <!-- Add Animation Page -->
                <div id="addAnimationPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">Add New Animation</h1>
                        <p class="page-subtitle">Create a new motion capture listing</p>
                    </div>

                    <div class="content-card">
                        <form id="addAnimationForm" onsubmit="handleAddAnimation(event)">
                            <!-- Basic Info -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Title *</label>
                                    <input type="text" class="form-input" name="title" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Slug *</label>
                                    <input type="text" class="form-input" name="slug" required placeholder="auto-generated-from-title">
                                </div>
                            </div>

                            <div class="form-grid full">
                                <div class="form-group">
                                    <label class="form-label">Description *</label>
                                    <textarea class="form-textarea" name="description" required></textarea>
                                </div>
                            </div>

                            <!-- Pricing & Details -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Price (USD) *</label>
                                    <input type="number" step="0.01" class="form-input" name="price" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Duration *</label>
                                    <input type="text" class="form-input" name="duration" placeholder="2:30" required>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Category *</label>
                                    <select class="form-select" name="category" required>
                                        <option value="">Select Category</option>
                                        <option value="Combat">Combat</option>
                                        <option value="Locomotion">Locomotion</option>
                                        <option value="Dance">Dance</option>
                                        <option value="Sports">Sports</option>
                                        <option value="Lifestyle">Lifestyle</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Sale Percentage (%)</label>
                                    <input type="number" min="0" max="100" class="form-input" name="sale_percentage" placeholder="0">
                                </div>
                            </div>

                            <!-- Technical Specs -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">File Size</label>
                                    <input type="text" class="form-input" name="file_size" placeholder="50 MB">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Frame Rate</label>
                                    <input type="text" class="form-input" name="frame_rate" placeholder="30 fps">
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Resolution</label>
                                    <input type="text" class="form-input" name="resolution" placeholder="1920x1080">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Format</label>
                                    <input type="text" class="form-input" name="format" placeholder="FBX, BVH">
                                </div>
                            </div>

                            <div class="form-grid full">
                                <div class="form-group">
                                    <label class="form-label">Compatible With</label>
                                    <input type="text" class="form-input" name="compatible_with" placeholder="Unreal Engine, Unity, Blender">
                                </div>
                            </div>

                            <!-- File Upload -->
                            <div class="form-group">
                                <label class="form-label">Animation GIF/Video</label>
                                <div class="file-upload" id="videoUpload" onclick="document.getElementById('videoFile').click()">
                                    <div class="upload-icon">üìÅ</div>
                                    <div class="upload-text">Click to upload or drag and drop</div>
                                    <div class="upload-hint">GIF, MP4 (Max 50MB)</div>
                                </div>
                                <input type="file" id="videoFile" accept="image/gif,video/mp4" style="display:none" onchange="handleFileSelect(event, 'video')">
                                <div id="videoPreview" class="file-preview"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Thumbnail Image</label>
                                <div class="file-upload" id="thumbnailUpload" onclick="document.getElementById('thumbnailFile').click()">
                                    <div class="upload-icon">üñºÔ∏è</div>
                                    <div class="upload-text">Click to upload thumbnail</div>
                                    <div class="upload-hint">PNG, JPG (Max 10MB)</div>
                                </div>
                                <input type="file" id="thumbnailFile" accept="image/*" style="display:none" onchange="handleFileSelect(event, 'thumbnail')">
                                <div id="thumbnailPreview" class="file-preview"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Downloadable File (FBX, BVH, etc.)</label>
                                <div class="file-upload" id="downloadUpload" onclick="document.getElementById('downloadFile').click()">
                                    <div class="upload-icon">üì¶</div>
                                    <div class="upload-text">Click to upload downloadable file</div>
                                    <div class="upload-hint">FBX, BVH, ZIP (Max 100MB) - This is what users download</div>
                                </div>
                                <input type="file" id="downloadFile" accept=".fbx,.bvh,.zip,.rar,.7z" style="display:none" onchange="handleFileSelect(event, 'download')">
                                <div id="downloadPreview" class="file-preview"></div>
                            </div>

                            <!-- Toggles -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Badges</label>
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="popular">
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <span>Popular</span>
                                    </div>
                                    <div class="toggle-group" style="margin-top: 12px;">
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="on_sale">
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <span>On Sale</span>
                                    </div>
                                    <div class="toggle-group" style="margin-top: 12px;">
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="holiday_sale">
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <span>Holiday Sale</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit -->
                            <div class="btn-group">
                                <button type="submit" class="btn btn-primary">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    Create Animation
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('addAnimationForm').reset()">
                                    Reset Form
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- All Animations Page -->
                <div id="allAnimationsPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">All Animations</h1>
                        <p class="page-subtitle">Manage your entire library</p>
                    </div>

                    <div class="content-card">
                        <div class="toolbar">
                            <div class="search-box">
                                <input type="text" class="search-input" id="searchAnimations" placeholder="Search animations...">
                            </div>
                            <button class="btn btn-primary" onclick="showPage('add-animation')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                Add New
                            </button>
                        </div>

                        <div id="animationsTable" class="loading">
                            <div class="spinner"></div>
                            Loading animations...
                        </div>
                    </div>
                </div>

                <!-- Bulk Edit Page -->
                <div id="bulkEditPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">Bulk Operations</h1>
                        <p class="page-subtitle">Edit multiple animations at once</p>
                    </div>

                    <div class="content-card">
                        <h2 class="card-title">Bulk Actions</h2>
                        <p style="color: var(--text-muted); margin-bottom: 24px;">
                            Select animations from the "All Animations" page, then apply bulk changes here.
                        </p>

                        <div class="form-grid">
                            <button class="btn btn-secondary" onclick="bulkToggle('popular', true)">
                                Set All as Popular
                            </button>
                            <button class="btn btn-secondary" onclick="bulkToggle('on_sale', true)">
                                Put All on Sale
                            </button>
                            <button class="btn btn-secondary" onclick="bulkUpdatePrice(0.8)">
                                Apply 20% Discount
                            </button>
                            <button class="btn btn-danger" onclick="bulkDelete()">
                                Delete Selected
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tags Page -->
                <!-- Hero Carousel Management Page -->
                <div id="carouselPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">Hero Carousel</h1>
                        <p class="page-subtitle">Manage the hero section carousel items</p>
                    </div>

                    <div class="content-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <h2 class="card-title">Carousel Items (7 items)</h2>
                            <button onclick="saveCarouselItems()" style="background: var(--teal); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                Save Changes
                            </button>
                        </div>
                        
                        <div id="carouselItemsList" style="display: flex; flex-direction: column; gap: 20px;">
                            <!-- Carousel items will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Tags Management Page -->
                <div id="tagsPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">Manage Tags</h1>
                        <p class="page-subtitle">Organize animation categories and tags</p>
                    </div>

                    <div class="content-card">
                        <h2 class="card-title">Coming Soon</h2>
                        <p style="color: var(--text-muted);">
                            Tag management interface will be available in the next update.
                        </p>
                    </div>
                </div>

                <!-- User Management Page -->
                <div id="usersPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">User Management</h1>
                        <p class="page-subtitle">Manage admin access and user roles</p>
                    </div>

                    <!-- User Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, rgba(100, 116, 139, 0.2), rgba(100, 116, 139, 0.05));">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--teal);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Total Users</div>
                                <div class="stat-value" id="totalUsersCount">-</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.05));">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--amber);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Admins</div>
                                <div class="stat-value" id="totalAdminsCount">-</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.05));">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--green);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Regular Users</div>
                                <div class="stat-value" id="regularUsersCount">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Admin Form -->
                    <div class="content-card">
                        <h2 class="card-title">Add New Admin</h2>
                        <form id="addAdminForm" onsubmit="handleAddAdmin(event)">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">User Email *</label>
                                    <input type="email" class="form-input" name="admin_email" placeholder="admin@example.com" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="submit" class="btn btn-primary">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                        </svg>
                                        Grant Admin Access
                                    </button>
                                </div>
                            </div>
                            <p style="color: var(--text-muted); font-size: 14px; margin-top: 12px;">
                                ‚ÑπÔ∏è The user must have already signed up on your site before you can make them an admin.
                            </p>
                        </form>
                    </div>

                    <!-- Current Admins -->
                    <div class="content-card">
                        <h2 class="card-title">Current Admins</h2>
                        <div id="adminsList" class="loading">
                            <div class="spinner"></div>
                            Loading admins...
                        </div>
                    </div>

                    <!-- All Users -->
                    <div class="content-card">
                        <h2 class="card-title">All Users</h2>
                        <div id="allUsersList" class="loading">
                            <div class="spinner"></div>
                            Loading users...
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        console.log('========================================');
        console.log('ADMIN DASHBOARD v4.0 - FILE UPLOADS WORKING!');
        console.log('Timestamp:', new Date().toISOString());
        console.log('========================================');
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://ekzablbemeponkrcitco.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVremFibGJlbWVwb25rcmNpdGNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NTkzNDQsImV4cCI6MjA4MTUzNTM0NH0.bhr5lIwDUA3prPuCN7mBj5Bn8lJhalPFu5MMS5I1g2I';
        const supabaseAdmin = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                persistSession: true,
                autoRefreshToken: true,
                detectSessionInUrl: true
            }
        });

        let currentUser = null;
        let uploadedFiles = {
            video: null,
            thumbnail: null,
            download: null
        };

        // Initialize
        async function init() {
            console.log('=== ADMIN DASHBOARD INIT ===');
            
            const { data: { session }, error } = await supabaseAdmin.auth.getSession();
            
            console.log('Session:', session);
            console.log('Session error:', error);
            console.log('User:', session?.user);
            
            if (session) {
                currentUser = session.user;
                console.log('User logged in:', currentUser.email);
                
                // Check if user is actually an admin
                const { data: userRole } = await supabaseAdmin
                    .from('user_roles')
                    .select('role')
                    .eq('user_id', currentUser.id)
                    .single();
                
                console.log('User role:', userRole);
                
                if (userRole && userRole.role === 'admin') {
                    console.log('‚úÖ User is admin - showing dashboard');
                    // User is admin, show dashboard
                    showDashboard();
                } else {
                    console.log('‚ùå User is NOT admin');
                    // User is logged in but NOT admin
                    alert('Access Denied: You must be an admin to access this page.');
                    window.location.href = 'index.html';
                }
            } else {
                console.log('‚ùå No session found - showing login');
                // Not logged in at all
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('userEmail').textContent = currentUser.email;
            loadOverviewStats();
        }

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const { data, error } = await supabaseAdmin.auth.signInWithPassword({
                email,
                password
            });

            if (error) {
                showNotification('Login failed: ' + error.message, 'error');
            } else {
                currentUser = data.user;
                
                // Check if user is admin
                const { data: userRole } = await supabaseAdmin
                    .from('user_roles')
                    .select('role')
                    .eq('user_id', currentUser.id)
                    .single();
                
                if (userRole && userRole.role === 'admin') {
                    showDashboard();
                } else {
                    showNotification('Access Denied: You are not an admin.', 'error');
                    await supabaseAdmin.auth.signOut();
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                }
            }
        }

        async function handleLogout() {
            await supabaseAdmin.auth.signOut();
            currentUser = null;
            showLogin();
        }

        // Page Navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            // Show selected page
            const pageMap = {
                'overview': 'overviewPage',
                'add-animation': 'addAnimationPage',
                'all-animations': 'allAnimationsPage',
                'bulk-edit': 'bulkEditPage',
                'carousel': 'carouselPage',
                'tags': 'tagsPage',
                'users': 'usersPage'
            };
            
            document.getElementById(pageMap[pageName]).classList.remove('hidden');
            event.target.closest('.nav-item').classList.add('active');

            // Load data for page
            if (pageName === 'overview') loadOverviewStats();
            if (pageName === 'all-animations') loadAllAnimations();
            if (pageName === 'carousel') loadCarouselItems();
            if (pageName === 'users') loadUsers();
        }

        // Load Overview Stats
        async function loadOverviewStats() {
            const { data: animations, error } = await supabaseAdmin
                .from('animations')
                .select('*');

            if (animations) {
                document.getElementById('totalAnimations').textContent = animations.length;
                document.getElementById('popularCount').textContent = animations.filter(a => a.popular).length;
                document.getElementById('onSaleCount').textContent = animations.filter(a => a.on_sale || a.holiday_sale).length;
                
                const categories = [...new Set(animations.map(a => a.category))];
                document.getElementById('categoriesCount').textContent = categories.length;

                // Recent additions
                const recent = animations.slice(0, 5);
                const recentHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Badges</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recent.map(anim => `
                                <tr>
                                    <td>${anim.title}</td>
                                    <td>${anim.category}</td>
                                    <td>$${anim.price.toFixed(2)}</td>
                                    <td>
                                        ${anim.popular ? '<span class="badge badge-popular">Popular</span>' : ''}
                                        ${anim.on_sale ? '<span class="badge badge-sale">On Sale</span>' : ''}
                                        ${anim.holiday_sale ? '<span class="badge badge-holiday">Holiday</span>' : ''}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                document.getElementById('recentAnimations').innerHTML = recentHTML;
            }
        }

        // Load All Animations
        async function loadAllAnimations() {
            document.getElementById('animationsTable').innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            
            const { data: animations, error } = await supabaseAdmin
                .from('animations')
                .select('*')
                .order('created_at', { ascending: false });

            if (animations) {
                const tableHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Thumbnail</th>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Duration</th>
                                <th>Badges</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${animations.map(anim => `
                                <tr>
                                    <td>
                                        <img src="${anim.thumbnail_url || anim.video_url}" class="table-thumbnail" alt="${anim.title}">
                                    </td>
                                    <td>${anim.title}</td>
                                    <td>${anim.category}</td>
                                    <td>$${anim.price.toFixed(2)}</td>
                                    <td>${anim.duration}</td>
                                    <td>
                                        ${anim.popular ? '<span class="badge badge-popular">‚òÖ</span>' : ''}
                                        ${anim.on_sale ? '<span class="badge badge-sale">üè∑Ô∏è</span>' : ''}
                                        ${anim.holiday_sale ? '<span class="badge badge-holiday">üéÅ</span>' : ''}
                                    </td>
                                    <td>
                                        <div class="table-actions">
                                            <button class="action-btn edit" onclick="editAnimation('${anim.id}')">Edit</button>
                                            <button class="action-btn delete" onclick="deleteAnimation('${anim.id}', '${anim.title}')">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                document.getElementById('animationsTable').innerHTML = tableHTML;
            }
        }

        // File Upload Handler
        function handleFileSelect(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            uploadedFiles[type] = file;

            const reader = new FileReader();
            reader.onload = function(e) {
                const previewDiv = document.getElementById(type + 'Preview');
                previewDiv.innerHTML = `
                    <div class="preview-item">
                        <img src="${e.target.result}" alt="Preview">
                        <button class="preview-remove" onclick="removeFile('${type}')" type="button">√ó</button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function removeFile(type) {
            uploadedFiles[type] = null;
            document.getElementById(type + 'Preview').innerHTML = '';
            document.getElementById(type + 'File').value = '';
        }

        // Add Animation
        async function handleAddAnimation(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            try {
                // Show loading state
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;"><circle cx="12" cy="12" r="10" stroke-width="4" stroke-dasharray="31.4" stroke-dashoffset="15.7"/></svg> Uploading...';
                
                let videoUrl = null;
                let thumbnailUrl = null;
                let downloadUrl = null;
                let videoType = 'image/gif';
                
                // Upload video/GIF file
                if (uploadedFiles.video) {
                    const file = uploadedFiles.video;
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
                    
                    const { data: uploadData, error: uploadError } = await supabaseAdmin.storage
                        .from('animations')
                        .upload(fileName, file, {
                            cacheControl: '3600',
                            upsert: false
                        });
                    
                    if (uploadError) throw uploadError;
                    
                    // Get public URL
                    const { data: { publicUrl } } = supabaseAdmin.storage
                        .from('animations')
                        .getPublicUrl(fileName);
                    
                    videoUrl = publicUrl;
                    videoType = file.type || 'image/gif';
                }
                
                // Upload thumbnail image
                if (uploadedFiles.thumbnail) {
                    const file = uploadedFiles.thumbnail;
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
                    
                    const { data: uploadData, error: uploadError } = await supabaseAdmin.storage
                        .from('thumbnails')
                        .upload(fileName, file, {
                            cacheControl: '3600',
                            upsert: false
                        });
                    
                    if (uploadError) throw uploadError;
                    
                    // Get public URL
                    const { data: { publicUrl } } = supabaseAdmin.storage
                        .from('thumbnails')
                        .getPublicUrl(fileName);
                    
                    thumbnailUrl = publicUrl;
                }
                
                // Upload downloadable file (if provided)
                if (uploadedFiles.download) {
                    const file = uploadedFiles.download;
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
                    
                    const { data: uploadData, error: uploadError } = await supabaseAdmin.storage
                        .from('downloads')
                        .upload(fileName, file, {
                            cacheControl: '3600',
                            upsert: false
                        });
                    
                    if (uploadError) throw uploadError;
                    
                    // Get public URL (for admin reference)
                    const { data: { publicUrl } } = supabaseAdmin.storage
                        .from('downloads')
                        .getPublicUrl(fileName);
                    
                    downloadUrl = publicUrl;
                }
                
                const animationData = {
                    title: formData.get('title'),
                    slug: formData.get('slug') || formData.get('title').toLowerCase().replace(/\s+/g, '-'),
                    description: formData.get('description'),
                    price: parseFloat(formData.get('price')),
                    duration: formData.get('duration'),
                    category: formData.get('category'),
                    sale_percentage: parseInt(formData.get('sale_percentage')) || null,
                    file_size: formData.get('file_size'),
                    frame_rate: formData.get('frame_rate'),
                    resolution: formData.get('resolution'),
                    format: formData.get('format'),
                    compatible_with: formData.get('compatible_with'),
                    popular: formData.get('popular') === 'on',
                    on_sale: formData.get('on_sale') === 'on',
                    holiday_sale: formData.get('holiday_sale') === 'on',
                    video_url: videoUrl || 'https://via.placeholder.com/400x300/1a1a2e/00d4ff?text=No+Video',
                    thumbnail_url: thumbnailUrl || videoUrl || 'https://via.placeholder.com/400x300/1a1a2e/00d4ff?text=No+Thumbnail',
                    file_url: downloadUrl,
                    video_type: videoType
                };

                const { data, error } = await supabaseAdmin
                    .from('animations')
                    .insert([animationData])
                    .select();

                if (error) throw error;
                
                showNotification('Animation created successfully!', 'success');
                event.target.reset();
                uploadedFiles = { video: null, thumbnail: null, download: null };
                document.getElementById('videoPreview').innerHTML = '';
                document.getElementById('thumbnailPreview').innerHTML = '';
                document.getElementById('downloadPreview').innerHTML = '';
                
                // Restore button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                
            } catch (error) {
                console.error('Upload error:', error);
                showNotification('Error: ' + error.message, 'error');
                
                // Restore button
                const submitBtn = event.target.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg> Create Animation';
            }
        }

        // Edit Animation
        function editAnimation(id) {
            // TODO: Implement edit functionality
            showNotification('Edit feature coming soon!', 'error');
        }

        // Delete Animation
        async function deleteAnimation(id, title) {
            if (!confirm(`Are you sure you want to delete "${title}"?`)) return;

            const { error } = await supabaseAdmin
                .from('animations')
                .delete()
                .eq('id', id);

            if (error) {
                showNotification('Error: ' + error.message, 'error');
            } else {
                showNotification('Animation deleted successfully!', 'success');
                loadAllAnimations();
                loadOverviewStats();
            }
        }

        // Notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Drag and drop
        ['videoUpload', 'thumbnailUpload', 'downloadUpload'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    element.classList.add('dragover');
                });
                
                element.addEventListener('dragleave', () => {
                    element.classList.remove('dragover');
                });
                
                element.addEventListener('drop', (e) => {
                    e.preventDefault();
                    element.classList.remove('dragover');
                    const type = id === 'videoUpload' ? 'video' : id === 'thumbnailUpload' ? 'thumbnail' : 'download';
                    const file = e.dataTransfer.files[0];
                    if (file) {
                        const fileInput = document.getElementById(type + 'File');
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        fileInput.files = dataTransfer.files;
                        handleFileSelect({ target: fileInput }, type);
                    }
                });
            }
        });

        // Auto-generate slug from title
        document.querySelector('[name="title"]')?.addEventListener('input', (e) => {
            const slug = e.target.value
                .toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-');
            document.querySelector('[name="slug"]').value = slug;
        });

        // ============================================
        // USER MANAGEMENT FUNCTIONS
        // ============================================

        // Load all users and admins
        async function loadUsers() {
            // Load admins
            loadAdmins();
            
            // Load all users
            document.getElementById('allUsersList').innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            
            const { data: users, error } = await supabaseAdmin.auth.admin.listUsers();
            
            if (error) {
                document.getElementById('allUsersList').innerHTML = '<p style="color: var(--red);">Error loading users. Make sure you have admin privileges.</p>';
                return;
            }

            // Get user roles
            const { data: roles } = await supabaseAdmin
                .from('user_roles')
                .select('*');

            const rolesMap = {};
            if (roles) {
                roles.forEach(r => rolesMap[r.user_id] = r.role);
            }

            // Update statistics
            const totalUsers = users.length;
            const adminCount = roles ? roles.filter(r => r.role === 'admin').length : 0;
            const regularUsers = totalUsers - adminCount;

            document.getElementById('totalUsersCount').textContent = totalUsers;
            document.getElementById('totalAdminsCount').textContent = adminCount;
            document.getElementById('regularUsersCount').textContent = regularUsers;

            const usersHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Signed Up</th>
                            <th>Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.email}</td>
                                <td>${new Date(user.created_at).toLocaleDateString()}</td>
                                <td>
                                    ${rolesMap[user.id] === 'admin' 
                                        ? '<span class="badge badge-popular">Admin</span>' 
                                        : '<span class="badge" style="background: rgba(156, 163, 175, 0.2); color: var(--text-muted);">User</span>'}
                                </td>
                                <td>
                                    ${rolesMap[user.id] !== 'admin' 
                                        ? `<button class="action-btn edit" onclick="makeAdmin('${user.id}', '${user.email}')">Make Admin</button>`
                                        : user.id !== currentUser.id 
                                            ? `<button class="action-btn delete" onclick="removeAdmin('${user.id}', '${user.email}')">Remove Admin</button>`
                                            : '<span style="color: var(--text-muted); font-size: 12px;">You</span>'}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('allUsersList').innerHTML = usersHTML;
        }

        // Load admins only
        async function loadAdmins() {
            document.getElementById('adminsList').innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            
            // Get admin roles
            const { data: adminRoles, error } = await supabaseAdmin
                .from('user_roles')
                .select('*')
                .eq('role', 'admin');

            if (error) {
                document.getElementById('adminsList').innerHTML = '<p style="color: var(--red);">Error loading admins.</p>';
                return;
            }

            if (!adminRoles || adminRoles.length === 0) {
                document.getElementById('adminsList').innerHTML = '<p style="color: var(--text-muted);">No admins found.</p>';
                return;
            }

            // Get all users to match emails
            const { data: allUsers } = await supabaseAdmin.auth.admin.listUsers();
            const userMap = {};
            if (allUsers) {
                allUsers.forEach(u => userMap[u.id] = u);
            }

            const adminsHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Admin Since</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminRoles.map(admin => {
                            const user = userMap[admin.user_id];
                            return `
                                <tr>
                                    <td>${user?.email || admin.user_id}</td>
                                    <td>${new Date(admin.created_at).toLocaleDateString()}</td>
                                    <td>
                                        ${admin.user_id !== currentUser.id 
                                            ? `<button class="action-btn delete" onclick="removeAdmin('${admin.user_id}', '${user?.email || 'this user'}')">Remove</button>`
                                            : '<span style="color: var(--text-muted); font-size: 12px;">You</span>'}
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('adminsList').innerHTML = adminsHTML;
        }

        // Add admin by email
        async function handleAddAdmin(event) {
            event.preventDefault();
            const email = event.target.admin_email.value;

            // First, get the user ID from email
            const { data: users } = await supabaseAdmin.auth.admin.listUsers();
            const user = users.find(u => u.email === email);

            if (!user) {
                showNotification(`User with email ${email} not found. They must sign up first.`, 'error');
                return;
            }

            // Add admin role
            const { error } = await supabaseAdmin
                .from('user_roles')
                .upsert({ 
                    user_id: user.id, 
                    role: 'admin' 
                });

            if (error) {
                showNotification('Error: ' + error.message, 'error');
            } else {
                showNotification(`${email} is now an admin!`, 'success');
                event.target.reset();
                loadUsers();
            }
        }

        // Make a user admin
        async function makeAdmin(userId, email) {
            if (!confirm(`Make ${email} an admin?`)) return;

            const { error } = await supabaseAdmin
                .from('user_roles')
                .upsert({ 
                    user_id: userId, 
                    role: 'admin' 
                });

            if (error) {
                showNotification('Error: ' + error.message, 'error');
            } else {
                showNotification(`${email} is now an admin!`, 'success');
                loadUsers();
            }
        }

        // Remove admin privileges
        async function removeAdmin(userId, email) {
            if (!confirm(`Remove admin access from ${email}?`)) return;

            const { error } = await supabaseAdmin
                .from('user_roles')
                .update({ role: 'user' })
                .eq('user_id', userId);

            if (error) {
                showNotification('Error: ' + error.message, 'error');
            } else {
                showNotification(`Admin access removed from ${email}`, 'success');
                loadUsers();
            }
        }

        // ===== CAROUSEL MANAGEMENT =====
        let carouselItems = [];

        async function loadCarouselItems() {
            try {
                const { data, error } = await supabaseAdmin
                    .from('carousel_items')
                    .select('*')
                    .order('position', { ascending: true });

                if (error) {
                    // If table doesn't exist, use default items
                    carouselItems = [
                        { position: 0, icon: 'üèÉ', title: 'Running Pack', subtitle: '12 animations', image_url: null, link_url: '' },
                        { position: 1, icon: '‚öîÔ∏è', title: 'Combat Pack', subtitle: '24 animations', image_url: null, link_url: '' },
                        { position: 2, icon: 'ü§∏', title: 'Acrobatic Pack', subtitle: '18 animations', image_url: null, link_url: '' },
                        { position: 3, icon: 'üßó', title: 'Climbing Pack', subtitle: '16 animations', image_url: null, link_url: '' },
                        { position: 4, icon: 'ü§æ', title: 'Sports Pack', subtitle: '20 animations', image_url: null, link_url: '' },
                        { position: 5, icon: 'üíÉ', title: 'Dance Pack', subtitle: '15 animations', image_url: null, link_url: '' },
                        { position: 6, icon: 'üßò', title: 'Idle Pack', subtitle: '10 animations', image_url: null, link_url: '' }
                    ];
                } else {
                    carouselItems = data;
                }

                renderCarouselItems();
            } catch (error) {
                console.error('Error loading carousel:', error);
                showNotification('Error loading carousel items', 'error');
            }
        }

        function renderCarouselItems() {
            const container = document.getElementById('carouselItemsList');
            if (!container) return;

            container.innerHTML = carouselItems.map((item, index) => `
                <div style="background: var(--bg-card); border: 1px solid rgba(100, 116, 139, 0.2); border-radius: 12px; padding: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="color: var(--text-white); font-size: 18px; font-weight: 600;">Item ${index + 1}</h3>
                        <span style="background: var(--teal); color: white; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 600;">Position ${index + 1}</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">Icon (Emoji)</label>
                            <input type="text" 
                                   value="${item.icon}" 
                                   onchange="updateCarouselItem(${index}, 'icon', this.value)"
                                   style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; color: var(--text-white); font-size: 24px; text-align: center;"
                                   placeholder="üéÆ">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">Title</label>
                            <input type="text" 
                                   value="${item.title}" 
                                   onchange="updateCarouselItem(${index}, 'title', this.value)"
                                   style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; color: var(--text-white);"
                                   placeholder="Animation Pack">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">Subtitle</label>
                            <input type="text" 
                                   value="${item.subtitle}" 
                                   onchange="updateCarouselItem(${index}, 'subtitle', this.value)"
                                   style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; color: var(--text-white);"
                                   placeholder="12 animations">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">Upload GIF/Image</label>
                            <input type="file" 
                                   accept="image/*,.gif"
                                   onchange="uploadCarouselImage(${index}, this)"
                                   style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; color: var(--text-white);">
                            <div id="upload-status-${index}" style="font-size: 12px; margin-top: 4px; color: var(--text-secondary);"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 16px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">Or paste Image URL:</label>
                        <input type="text" 
                               value="${item.image_url || ''}" 
                               onchange="updateCarouselItem(${index}, 'image_url', this.value); renderCarouselItems();"
                               style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; color: var(--text-white);"
                               placeholder="https://...">
                    </div>
                    
                    <div style="margin-top: 16px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">Link URL (where clicking goes):</label>
                        <input type="text" 
                               value="${item.link_url || ''}" 
                               onchange="updateCarouselItem(${index}, 'link_url', this.value)"
                               style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; color: var(--text-white);"
                               placeholder="animation-detail.html?slug=combat-pack">
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Examples: animation-detail.html?slug=combat-pack or index.html#library</div>
                    </div>
                    
                    ${item.image_url ? `
                        <div style="margin-top: 16px;">
                            <label style="display: block; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">Preview:</label>
                            <img src="${item.image_url}" style="width: 100%; max-width: 300px; height: auto; border-radius: 8px; border: 1px solid rgba(100, 116, 139, 0.3);">
                            <button onclick="removeCarouselImage(${index})" style="margin-top: 8px; padding: 8px 16px; background: rgba(255, 107, 107, 0.2); border: 1px solid rgba(255, 107, 107, 0.5); border-radius: 6px; color: #FF6B6B; cursor: pointer; font-size: 12px;">
                                Remove Image
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function updateCarouselItem(index, field, value) {
            carouselItems[index][field] = value;
        }

        function removeCarouselImage(index) {
            carouselItems[index].image_url = null;
            renderCarouselItems();
        }

        async function uploadCarouselImage(index, input) {
            const file = input.files[0];
            if (!file) return;

            const statusDiv = document.getElementById(`upload-status-${index}`);
            statusDiv.textContent = 'Uploading...';
            statusDiv.style.color = 'var(--teal)';

            try {
                // Create unique filename
                const timestamp = Date.now();
                const fileExt = file.name.split('.').pop();
                const fileName = `carousel-${index}-${timestamp}.${fileExt}`;
                const filePath = `carousel/${fileName}`;

                // Upload to Supabase Storage
                const { data, error } = await supabaseAdmin.storage
                    .from('animations')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });

                if (error) throw error;

                // Get public URL
                const { data: { publicUrl } } = supabaseAdmin.storage
                    .from('animations')
                    .getPublicUrl(filePath);

                // Update carousel item with new URL
                carouselItems[index].image_url = publicUrl;
                
                statusDiv.textContent = '‚úì Uploaded successfully!';
                statusDiv.style.color = '#10B981';
                
                // Re-render to show preview
                setTimeout(() => {
                    renderCarouselItems();
                }, 500);

            } catch (error) {
                console.error('Upload error:', error);
                statusDiv.textContent = '‚úó Upload failed: ' + error.message;
                statusDiv.style.color = '#FF6B6B';
            }
        }

        async function saveCarouselItems() {
            try {
                // Try to create table if it doesn't exist
                const { error: createError } = await supabaseAdmin.rpc('create_carousel_table', {});
                
                // Delete existing items
                await supabaseAdmin.from('carousel_items').delete().neq('position', -1);
                
                // Insert new items
                const { error } = await supabaseAdmin
                    .from('carousel_items')
                    .insert(carouselItems);

                if (error) {
                    showNotification('Error saving carousel: ' + error.message, 'error');
                } else {
                    showNotification('Carousel updated successfully!', 'success');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Note: Carousel updated locally. Database sync may require manual setup.', 'warning');
            }
        }

        // Initialize app
        init();
    </script>
</body>
</html>
